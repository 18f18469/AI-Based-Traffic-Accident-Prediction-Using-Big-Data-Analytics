{% extends "layout.html" %}
{% block content %}

<!-- ===== Header ===== -->
<header class="main-header text-center mb-4">
  <div class="logo-circle">ðŸš¦</div>
  <h1 class="title">{{ t["title"] }}</h1>
  <p class="subtitle">AI-Based Traffic Accident Prediction System</p>
</header>

<!-- ===== Dashboard ===== -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <h6>Total Predictions</h6>
        <h3>{{ risk_stats.total }}</h3>
      </div>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card text-center shadow-sm border-success">
      <div class="card-body">
        <h6>Low Risk</h6>
        <h3 class="text-success">{{ risk_stats.low }}</h3>
      </div>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card text-center shadow-sm border-warning">
      <div class="card-body">
        <h6>Medium Risk</h6>
        <h3 class="text-warning">{{ risk_stats.medium }}</h3>
      </div>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card text-center shadow-sm border-danger">
      <div class="card-body">
        <h6>High Risk</h6>
        <h3 class="text-danger">{{ risk_stats.high }}</h3>
      </div>
    </div>
  </div>
</div>

<!-- ===== Prediction Form ===== -->
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <h5 class="mb-3">{{ t["predict"] }}</h5>

    <form method="POST" class="row g-3">
      <div class="col-md-3">
        <label class="form-label">{{ t["day"] }}</label>
        <select name="day" class="form-select" required>
          {% for d in days %}
            <option value="{{ d }}">{{ d }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">{{ t["hour"] }}</label>
        <input type="number" name="hour" class="form-control" min="0" max="23" value="13" required>
      </div>

      <div class="col-md-3">
        <label class="form-label">{{ t["injuries"] }}</label>
        <input type="number" name="injuries" class="form-control" min="0" value="0" required>
      </div>

      <div class="col-md-12">
        <label class="form-label">{{ t["location"] }}</label>
        <select name="location" class="form-select" required>
          {% for loc in locations %}
            <option value="{{ loc }}">{{ loc }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-12 text-end">
        <button class="btn btn-success px-4">
          {{ t["predict"] }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- ===== Prediction Result ===== -->
{% if risk_score is not none %}
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <h5 class="mb-3">{{ t["result"] }}</h5>

    <p><strong>{{ t["risk_score"] }}:</strong> {{ risk_score }}%</p>

    <p>
      <strong>{{ t["risk_level"] }}:</strong>
      <span class="badge
        {% if risk_level == 'Low' %} bg-success
        {% elif risk_level == 'Medium' %} bg-warning text-dark
        {% else %} bg-danger
        {% endif %}">
        {{ risk_level }}
      </span>
    </p>

    <div class="progress" style="height:25px;">
      <div class="progress-bar
        {% if risk_level == 'Low' %} bg-success
        {% elif risk_level == 'Medium' %} bg-warning
        {% else %} bg-danger
        {% endif %}"
        style="width: {{ risk_score }}%;">
        {{ risk_score }}%
      </div>
    </div>
  </div>
</div>
{% endif %}

<!-- ===== Pie Chart ===== -->
{% if risk_stats.total > 0 %}
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <div class="chart-container">
    <canvas id="riskChart"></canvas>
</div>

    <h5 class="mb-3">Risk Distribution</h5>
    <canvas id="riskPieChart"></canvas>
  </div>
</div>


{% endif %}

<!-- ===== History ===== -->
<div class="card shadow-sm">
  <div class="card-body">
    <h5 class="mb-3">{{ t["history"] }}</h5>
    <div class="table-responsive">
      <table class="table table-striped table-sm align-middle">
        <thead>
          <tr>
            <th>#</th>
            <th>{{ t["day"] }}</th>
            <th>{{ t["hour"] }}</th>
            <th>{{ t["injuries"] }}</th>
            <th>{{ t["location"] }}</th>
            <th>{{ t["result"] }}</th>
            <th>Time</th>
          </tr>
        </thead>
        <tbody>
          {% for r in history %}
          <tr>
            <td>{{ r["id"] }}</td>
            <td>{{ r["day"] }}</td>
            <td>{{ r["hour"] }}</td>
            <td>{{ r["injuries"] }}</td>
            <td>{{ r["location"] }}</td>
            <td><span class="badge bg-dark">{{ r["prediction_result"] }}</span></td>
            <td>{{ r["created_at"] }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- ===== Scripts ===== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% if risk_stats.total > 0 %}
<script>
const ctx = document.getElementById('riskPieChart');
new Chart(ctx, {
  type: 'pie',
  data: {
    labels: ['Low', 'Medium', 'High'],
    datasets: [{
      data: [
        {{ risk_stats.low }},
        {{ risk_stats.medium }},
        {{ risk_stats.high }}
      ],
      backgroundColor: ['#198754', '#ffc107', '#dc3545']
    }]
  },
  options: {
    responsive: true,
    plugins: { legend: { position: 'bottom' } }
  }
});
</script>
{% endif %}

{% endblock %}
